<!DOCTYPE html>
<html lang="PL-pl">
  <head>
    <meta charset="UTF-8" />
    <title>Logowanie</title>
  </head>

  <body
    style="
      height: 100%;
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background-color: #f03a47;
    "
  >
    <img
      src="https://cdn.discordapp.com/attachments/1028055005351125034/1029110950936203305/logo2.png"
      width="30%"
    />
    <hr size="10" color="(11, 3, 45)" />

    <main
      id="main-holder"
      style="
        width: 100%;
        height: 70%;
        display: grid;
        justify-items: center;
        align-items: center;
        background-color: rgb(234, 242, 239);
        border-radius: 7px;
        box-shadow: 0px 0px 5px 2px rgb(11, 3, 45);
      "
    >
      <h1 id="login-header">Zaloguj się</h1>

      <form id="login-form">
        <input
          type="text"
          name="username"
          id="username-field"
          class="login-form-field"
          placeholder="Nazwa użytkownika"
        />
        <input
          type="password"
          name="password"
          id="password-field"
          class="login-form-field"
          placeholder="Hasło"
        />
        <input type="submit" value="Zaloguj" id="login-form-submit" />
      </form>
    </main>
    <script src="./node_modules/axios/dist/axios.min.js"></script>
    <script>
      const loginForm = document.getElementById("login-form");
      const loginButton = document.getElementById("login-form-submit");
      const loginErrorMsg = document.getElementById("login-error-msg");

      loginButton.addEventListener("click", async (e) => {
        e.preventDefault();
        const username = loginForm.username.value;
        const password = loginForm.password.value;

        const user = username.split(" ");

        await axios
          .get(
            `http://87.206.112.180:43638/api/v1/user/login?password=${password}&firstname=${user[0]}&lastname=${user[1]}`
          )
          .then(function (response) {
            if (response.data == true) {
              axios
                .get(
                  `http://87.206.112.180:43638/api/v1/user?firstname=${user[0]}&lastname=${user[1]}`
                )
                .then(function (result) {
                  if (result.data.wykonawca_id != null) {
                    location.reload();
                    localStorage.setItem("loged", username);
                    localStorage.setItem("userid", result.data.wykonawca_id);
                    location.assign("http://87.206.112.180:43637/index.html");
                  } else if(result.data.uzytkownik_id != null) {
                    location.reload();
                    localStorage.setItem("loged", username);
                    localStorage.setItem("userid", result.data.uzytkownik_id);
                    location.assign("http://87.206.112.180:43637/index.html");
                  }
                });
            } else if (response.data == false) {
            } else {
            }
          });
      });
    </script>
  </body>
</html>
